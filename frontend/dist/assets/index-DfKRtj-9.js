(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();function O(){const t=document.createElement("div");t.className="flex flex-col items-center justify-center min-h-screen bg-gradient-to-b from-gray-900 to-black text-white text-center p-6";const e=document.createElement("h1");e.className="text-5xl font-bold mb-4",e.innerText="Bienvenue sur Ft Transcendence !";const o=document.createElement("p");o.className="text-lg text-gray-300 mb-6 max-w-2xl",o.innerText="Rejoignez une aventure épique où vous affrontez vos amis dans des tournois de Pong compétitifs ! Inscrivez-vous dès maintenant pour commencer.";const r=document.createElement("div");r.className="flex space-x-4";const n=document.createElement("button");n.className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded",n.innerText="Se Connecter",n.onclick=c=>h(c,"/login");const s=document.createElement("button");return s.className="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded",s.innerText="S'inscrire",s.onclick=c=>h(c,"/register"),r.appendChild(n),r.appendChild(s),t.appendChild(e),t.appendChild(o),t.appendChild(r),t}const i={user:JSON.parse(localStorage.getItem("user")||"null"),token:localStorage.getItem("token")||null};function J(t,e){i.token=t,i.user=e,localStorage.setItem("token",t),localStorage.setItem("user",JSON.stringify(e))}function W(){const t=localStorage.getItem("token"),e=localStorage.getItem("user");t&&e&&(i.token=t,i.user=JSON.parse(e))}function B(){return!!i.token}function X(){i.user=null,i.token=null,localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"}async function R(t,e){const o=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:e})}),r=await o.json();if(!o.ok)throw new Error(r.error||"Erreur de connexion");i.user=r.user,i.token=r.token,localStorage.setItem("token",r.token),localStorage.setItem("user",JSON.stringify(r.user)),window.location.href="/dashboard"}async function F(t,e,o){const r=await fetch("/api/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,email:e,password:o})}),n=await r.json();if(!r.ok)throw new Error(n.error||"Erreur d'inscription");J(n.token,n.user),window.location.href="/profile"}function U(){const t=document.createElement("nav");t.className="bg-gray-900 p-4 flex justify-between";const e=document.createElement("a");e.innerText="Accueil",e.className="text-white cursor-pointer",e.onclick=()=>h(new Event("click"),"/");const o=document.createElement("div");if(B()){const r=document.createElement("button");r.innerText="Profil",r.className="text-white mx-2",r.onclick=()=>h(new Event("click"),"/profile");const n=document.createElement("button");n.innerText="Déconnexion",n.className="text-red-400 mx-2",n.onclick=X,o.appendChild(r),o.appendChild(n)}else{const r=document.createElement("button");r.innerText="Connexion",r.className="text-white mx-2",r.onclick=()=>h(new Event("click"),"/login");const n=document.createElement("button");n.innerText="S'inscrire",n.className="text-white mx-2",n.onclick=()=>h(new Event("click"),"/register"),o.appendChild(r),o.appendChild(n)}return t.appendChild(e),t.appendChild(o),t}function Y(t){const e=document.createElement("div");e.className="min-h-screen flex flex-col bg-gray-900 text-white",e.appendChild(U());const o=document.createElement("div");return o.className="flex flex-col items-center justify-center min-h-screen mt-16 px-4 w-full",o.appendChild(t),e.appendChild(o),e}const M=1e3,y=500,d={x:20,y:y/2-50,width:10,height:100,speed:4},f={x:M-30,y:y/2-50,width:10,height:100,speed:4},a={x:M/2,y:y/2,radius:10,speedX:3,speedY:3,acceleration:1.05};let $=0,_=0;function q(){return{score1:$,score2:_}}function A(t){t===1?$++:t===2&&_++}function I(){a.x=M/2,a.y=y/2,a.speedX=a.speedX>0?-3:3,a.speedY=(Math.random()*2-1)*3}function j(){a.speedX*=a.acceleration,a.speedY*=a.acceleration}function G(t){const e=t.getContext("2d");function o(){if(!e)return;e.clearRect(0,0,t.width,t.height);const{score1:r,score2:n}=q();e.fillStyle="white",e.font="32px Arial",e.fillText(r.toString(),t.width/4,50),e.fillText(n.toString(),t.width*3/4,50),e.fillRect(d.x,d.y,d.width,d.height),e.fillRect(f.x,f.y,f.width,f.height),e.beginPath(),e.arc(a.x,a.y,a.radius,0,Math.PI*2),e.fill(),a.x+=a.speedX,a.y+=a.speedY,(a.y-a.radius<=0||a.y+a.radius>=t.height)&&(a.speedY*=-1),a.x-a.radius<=d.x+d.width&&a.y>=d.y&&a.y<=d.y+d.height&&(a.speedX*=-1,a.x=d.x+d.width+a.radius,j()),a.x+a.radius>=f.x&&a.y>=f.y&&a.y<=f.y+f.height&&(a.speedX*=-1,a.x=f.x-a.radius,j()),a.x+a.radius<=0&&(A(2),I()),a.x-a.radius>=t.width&&(A(1),I()),requestAnimationFrame(o)}o()}const x={};function V(t,e,o){document.addEventListener("keydown",n=>{["ArrowUp","ArrowDown","z","s"].includes(n.key)&&(n.preventDefault(),x[n.key]=!0)}),document.addEventListener("keyup",n=>{["ArrowUp","ArrowDown","z","s"].includes(n.key)&&(x[n.key]=!1)});function r(){x.z&&t.y>0&&(t.y-=t.speed),x.s&&t.y+t.height<o&&(t.y+=t.speed),x.ArrowUp&&e.y>0&&(e.y-=e.speed),x.ArrowDown&&e.y+e.height<o&&(e.y+=e.speed),requestAnimationFrame(r)}r()}function K(){const t=document.createElement("div");t.className="flex flex-col items-center justify-center min-h-screen p-4 text-center";const e=document.createElement("h1");e.className="text-3xl font-bold mb-4",e.innerText="🏓 Mode Pong";const o=document.createElement("canvas");return o.width=1e3,o.height=500,o.className="border-4 border-white",t.appendChild(e),t.appendChild(o),setTimeout(()=>{G(o),V(d,f,o.height)},100),Y(t)}async function Q(){return await(await fetch("/api/users")).json()}async function Z(t,e){return(await fetch("/api/users/update",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,email:e})})).ok}function ee(){if(!i.user)return window.location.href="/login",document.createElement("div");const t=document.createElement("div");t.className="flex flex-col items-start p-6 bg-gray-900 text-white rounded-xl shadow-lg w-96 mt-6 ml-24 border border-gray-700";const e=document.createElement("h2");e.innerText="Profile Management",e.className="text-3xl font-bold mb-4 text-left text-blue-400";const o=document.createElement("img");o.src=i.user.avatar||"default-avatar.png",o.className="w-24 h-24 rounded-full border-2 border-blue-400 mb-3";const r=document.createElement("input");r.type="text",r.value=i.user.username,r.className="input-style";const n=document.createElement("input");n.type="email",n.value=i.user.email,n.className="input-style";const s=document.createElement("button");s.innerText="Save",s.className="btn-primary",s.onclick=async()=>{await Z(r.value,n.value)?(i.user.username=r.value,i.user.email=n.value,alert("Profile updated!")):alert("Error updating profile")};const c=document.createElement("div");c.className="absolute top-6 left-6 w-12 h-12 bg-gray-700 rounded-lg flex items-center justify-center cursor-pointer text-white text-xl transition duration-300 transform hover:scale-110 hover:bg-gray-600 shadow-lg",c.innerHTML='<svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"></path></svg>',c.onclick=()=>{window.history.back()};const u=document.createElement("div");u.className="grid grid-cols-12 gap-4 w-full h-screen p-4";const m=document.createElement("div");m.className="col-span-3 bg-gray-800 rounded-lg shadow-lg p-4 flex flex-col items-center",m.append(e,o,r,n,s);const w=document.createElement("div");w.className="col-span-6 bg-gray-800 rounded-lg shadow-lg p-4 flex items-center justify-center",w.innerText="Leaderboard";const b=document.createElement("div");b.className="col-span-3 bg-gray-800 rounded-lg shadow-lg p-4 flex flex-col";const v=document.createElement("h3");v.innerText="Matches History",v.className="text-lg font-bold text-white mb-2";const E=document.createElement("div");E.className="flex flex-col gap-2";async function z(){try{const p=await(await fetch(`/api/matches?userId=${i.user.id}`)).json();console.log("Matches received:",p),p.forEach(l=>{console.log(`Appending match: ${l.player1_name} vs ${l.player2_name} - Winner: ${l.winner_name}`);const S=document.createElement("div"),H=l.winner_name===i.user.username;S.className=`p-2 rounded-lg text-white text-sm flex items-center space-x-2 ${H?"bg-blue-600":"bg-red-600"}`;const C=document.createElement("img");C.src=l.player1_avatar||"default-avatar.png",C.className="w-8 h-8 rounded-full border-2 border-white";const L=document.createElement("img");L.src=l.player2_avatar||"default-avatar.png",L.className="w-8 h-8 rounded-full border-2 border-white";const P=document.createElement("span");P.innerText=`${new Date(l.played_at).toLocaleDateString()} - ${l.player1_name} VS ${l.player2_name} → Winner: ${l.winner_name}`,S.append(C,P,L),E.appendChild(S)})}catch(g){console.error("Error fetching match history:",g)}}z(),b.append(v,E);const N=document.createElement("div");N.className="col-span-12 bg-gray-800 rounded-lg shadow-lg p-4 flex items-center justify-center",N.innerText="Stats",u.append(m,w,b,N);const k=document.createElement("div");k.className="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0";for(let g=0;g<100;g++){const p=document.createElement("div");p.className="absolute bg-white rounded-full opacity-75 animate-twinkle";const l=Math.random()*3+"px";p.style.width=l,p.style.height=l,p.style.top=Math.random()*100+"vh",p.style.left=Math.random()*100+"vw",p.style.animationDuration=Math.random()*3+2+"s",k.appendChild(p)}const T=document.createElement("div");return T.className="relative w-full h-screen flex flex-col",T.append(k,c,u),T}function D(){const t=document.createElement("form");t.className="flex flex-col items-center p-6 bg-gray-900 text-white rounded-xl shadow-lg w-96 mx-auto mt-20 border border-gray-700";const e=document.createElement("h2");e.innerText="Connexion",e.className="text-3xl font-bold mb-4 text-center text-blue-400";const o=document.createElement("input");o.type="text",o.placeholder="Nom d'utilisateur",o.className="input-style";const r=document.createElement("input");r.type="password",r.placeholder="Mot de passe",r.className="input-style";const n=document.createElement("p");n.className="text-red-500 text-sm mt-2 hidden";const s=document.createElement("button");s.innerText="Se connecter",s.className="btn-primary",s.onclick=async u=>{u.preventDefault(),n.classList.add("hidden");try{await R(o.value,r.value),h(new Event("click"),"/register")}catch(m){n.innerText="Erreur : "+m.message,n.classList.remove("hidden")}};const c=document.createElement("a");return c.innerText="Pas encore inscrit ?",c.className="text-blue-400 hover:underline mt-3 cursor-pointer",c.onclick=u=>{u.preventDefault(),h(new Event("click"),"/register")},t.append(e,o,r,n,s,c),t}function te(){const t=document.createElement("form");t.className="flex flex-col items-center p-6 bg-gray-900 text-white rounded-xl shadow-lg w-96 mx-auto mt-20 border border-gray-700";const e=document.createElement("h2");e.innerText="Inscription",e.className="text-3xl font-bold mb-4 text-center text-blue-400";const o=document.createElement("input");o.type="text",o.placeholder="Nom d'utilisateur",o.className="input-style";const r=document.createElement("input");r.type="email",r.placeholder="Email",r.className="input-style";const n=document.createElement("input");n.type="password",n.placeholder="Mot de passe",n.className="input-style";const s=document.createElement("p");s.className="text-red-500 text-sm mt-2 hidden";const c=document.createElement("button");return c.innerText="S'inscrire",c.className="btn-primary",c.onclick=async u=>{u.preventDefault(),s.classList.add("hidden");try{await F(o.value,r.value,n.value),window.location.href="/login"}catch(m){s.innerText="Erreur : "+m.message,s.classList.remove("hidden")}},t.append(e,o,r,n,s,c),t}function ne(){if(!i.user)return window.location.href="/login",document.createElement("div");const t=document.createElement("div");t.className="flex flex-col items-center p-6 bg-gray-900 text-white rounded-xl shadow-lg w-96 mx-auto mt-20 border border-gray-700";const e=document.createElement("h2");e.innerText=`🏠 Bienvenue ${i.user.username}`,e.className="text-3xl font-bold mb-4 text-center text-blue-400";const o=document.createElement("p");o.innerText="📡 Liste des utilisateurs",o.className="text-lg text-gray-300";const r=document.createElement("ul");r.className="mt-4 text-white";async function n(){const c=await Q();r.innerHTML="",c.forEach(u=>{const m=document.createElement("li");m.innerText=`${u.username}`,r.appendChild(m)})}n();const s=document.createElement("button");return s.innerText="👤 Voir mon profil",s.className="btn-primary mt-4",s.onclick=()=>{window.location.href="/profile"},t.append(e,o,r,s),t}const re={"/":O,"/game":K,"/profile":()=>B()?ee():D(),"/login":D,"/dashboard":ne,"/register":te};function h(t,e){t.preventDefault(),window.history.pushState({},e,window.location.origin+e),window.dispatchEvent(new Event("popstate"))}function oe(){const t=document.getElementById("app");if(!t)return;const e=()=>{const o=window.location.pathname,r=re[o]||O;t.innerHTML="",t.appendChild(r())};window.addEventListener("popstate",e),e()}document.addEventListener("DOMContentLoaded",()=>{W(),oe()});
